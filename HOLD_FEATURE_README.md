# Hold Feature Documentation

## Огляд

Фіча hold дозволяє диспечерам ставити водіїв на 15-хвилинний холд. Це корисно для тимчасового резервування водіїв під час переговорів або планування.

## Функціональність

### Основні можливості

1. **Постановка на hold** - диспечер може поставити водія на 15-хвилинний холд
2. **Автоматичне зняття** - hold автоматично знімається через 15 хвилин
3. **Ручне зняття** - тільки диспечер який поставив hold може його зняти
4. **Візуальний індикатор** - показує статус hold та countdown
5. **Tooltip інформація** - показує хто поставив hold при наведенні

### UI/UX

- **Колонка "Mark/Hold"** - замінила колонку "Loads/Mark"
- **Кнопка HOLD** - з'являється при наведенні на комірку
- **Бейдж "ON HOLD"** - червоний бейдж з countdown
- **Countdown** - показує залишковий час у форматі MM:SS
- **Tooltip** - показує "Hold by: [Dispatcher Name]"

## Технічна реалізація

### База даних

Додані нові поля в таблицю `Trucks`:

```sql
ALTER TABLE Trucks 
ADD COLUMN hold_status ENUM('active', 'expired') DEFAULT NULL,
ADD COLUMN hold_started_at TIMESTAMP NULL DEFAULT NULL,
ADD COLUMN hold_dispatcher_id INT NULL DEFAULT NULL,
ADD COLUMN hold_dispatcher_name VARCHAR(255) NULL DEFAULT NULL;
```

### Backend API

#### Нові endpoints:

- `POST /trucks/{id}/hold` - поставити hold
- `DELETE /trucks/{id}/hold` - зняти hold
- `GET /trucks/{id}/hold` - отримати інформацію про hold
- `GET /trucks/hold/cleanup` - очистити застарілі hold

#### Нові методи в TruckController:

- `placeHold($truckId, $dispatcherId, $dispatcherName)`
- `removeHold($truckId, $dispatcherId)`
- `cleanupExpiredHolds()`
- `getHoldInfo($truckId)`

### Frontend

#### Нові компоненти:

- `HoldCell.js` - компонент для відображення hold функціональності
- Стилі в `TruckTable.css` для hold елементів

#### Оновлені компоненти:

- `TruckTable.js` - інтеграція HoldCell
- `App.js` - додано методи для роботи з hold API

## Безпека

### Валідація прав доступу

- Тільки диспечери можуть ставити/знімати hold
- Тільки автор hold може його зняти
- Автоматичне очищення застарілих hold

### Логування

Всі hold дії логуються через ActivityLogger:

- `truck_hold_placed` - при постановці hold
- `truck_hold_removed` - при знятті hold

## Інтеграція з існуючою системою

### Автоматичне очищення

Hold автоматично очищаються при:
- Розрахунку дистанцій (в DistanceController)
- Ручному виклику cleanup API

### Оновлення даних

- При будь-якій операції з hold оновлюється таблиця водіїв
- Countdown оновлюється кожну секунду
- Візуальні індикатори оновлюються в реальному часі

## Використання

### Для диспечерів:

1. **Постановка hold**: Наведіть на комірку "Mark/Hold" і натисніть кнопку "HOLD"
2. **Зняття hold**: Натисніть на червоний бейдж "ON HOLD" (тільки для вашого hold)
3. **Перегляд інформації**: Наведіть на бейдж для побачення автора hold

### Для користувачів:

- Всі користувачі бачать hold статус
- Countdown показує залишковий час
- Tooltip показує хто поставив hold

## Тестування

### Тестові сценарії:

1. **Постановка hold**:
   - Наведіть на комірку Mark/Hold
   - Натисніть HOLD
   - Перевірте появу червоного бейджа

2. **Countdown**:
   - Поставте hold
   - Перевірте countdown (15:00 → 14:59 → ...)
   - Дочекайтеся автоматичного зняття

3. **Ручне зняття**:
   - Поставте hold
   - Натисніть на бейдж
   - Перевірте зняття hold

4. **Права доступу**:
   - Спробуйте зняти чужой hold
   - Перевірте повідомлення про помилку

## Відомі обмеження

1. **WebSocket відсутній** - оновлення через polling
2. **15 хвилин фіксований час** - не налаштовується
3. **Один hold на водія** - не можна поставити кілька hold

## Майбутні покращення

1. **Налаштування часу** - дозволити різний час hold
2. **WebSocket підтримка** - реальний час оновлення
3. **Історія hold** - логування всіх hold операцій
4. **Push повідомлення** - сповіщення про закінчення hold 