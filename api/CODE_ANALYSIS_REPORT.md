# –ó–≤—ñ—Ç –ø—Ä–æ –∞–Ω–∞–ª—ñ–∑ PHP –±–µ–∫–µ–Ω–¥—É Connex API

## –ó–∞–≥–∞–ª—å–Ω–∞ —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—è
- **–î–∞—Ç–∞ –∞–Ω–∞–ª—ñ–∑—É**: 14 —Å–µ—Ä–ø–Ω—è 2024
- **–Ü–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–∏**: PHPStan, PHP CodeSniffer, PHPMD, PHPCPD, PDepend
- **–ó–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —Ä—è–¥–∫—ñ–≤ –∫–æ–¥—É**: 8,487
- **–í—ñ–¥—Å–æ—Ç–æ–∫ –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤**: 1.68%

## üî¥ –ö—Ä–∏—Ç–∏—á–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏ (PHPStan)

### 1. –ù–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –º–µ—Ç–æ–¥–∏ (–º–µ—Ä—Ç–≤–∏–π –∫–æ–¥)
- `DistanceController::logDistanceStats()` - —Ä—è–¥–æ–∫ 453
- `DistanceController::getDistancesFromMapboxMatrix()` - —Ä—è–¥–æ–∫ 481
- `DistanceController::checkDistanceCache()` - —Ä—è–¥–æ–∫ 556
- `DistanceController::cacheDistanceNormalized()` - —Ä—è–¥–æ–∫ 595
- `DistanceController::getDistanceFromMapbox()` - —Ä—è–¥–æ–∫ 622
- `DistanceController::backgroundResultsCaching()` - —Ä—è–¥–æ–∫ 886
- `DistanceController::bulkCacheCheckOptimized()` - —Ä—è–¥–æ–∫ 1017
- `DriverUpdatesController::parseWhenWillBeThereDate()` - —Ä—è–¥–æ–∫ 211

### 2. –ù–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ
- `DistanceController::$httpClient` - —Ä—è–¥–∫–∏ 500, 637
- `TruckController::$oldLocation`, `$newLocation` - —Ä—è–¥–∫–∏ 695-696

### 3. –ù–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ
- `RbacController::$pdo` - —Ä—è–¥–æ–∫ 213

### 4. –ü—Ä–æ–±–ª–µ–º–∏ –∑ —Ç–∏–ø–∞–º–∏
- –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è –º–∞—Å–∏–≤—ñ–≤ –∑ —á–∏—Å–ª–∞–º–∏ - —Ä—è–¥–∫–∏ 235, 627, 718
- –ù–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –º–µ—Ç–æ–¥—ñ–≤ `DateTimeImmutable::modify()`

## üü† –ü—Ä–æ–±–ª–µ–º–∏ –∑—ñ —Å—Ç–∏–ª–µ–º –∫–æ–¥—É (PHP CodeSniffer)

### –ó–∞–≥–∞–ª—å–Ω–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
- **–í—Å—å–æ–≥–æ –ø–æ–º–∏–ª–æ–∫**: 1,000+
- **–ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –≤–∏–ø—Ä–∞–≤–ª—é–≤–∞–Ω–∏—Ö**: 900+

### –û—Å–Ω–æ–≤–Ω—ñ –ø—Ä–æ–±–ª–µ–º–∏
1. **–í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Ç–∞–±—ñ–≤ –∑–∞–º—ñ—Å—Ç—å –ø—Ä–æ–±—ñ–ª—ñ–≤** - –æ—Å–æ–±–ª–∏–≤–æ –≤ `DriverUpdatesController.php`
2. **–ü—Ä–æ–±—ñ–ª–∏ –≤ –∫—ñ–Ω—Ü—ñ —Ä—è–¥–∫—ñ–≤** - –ø–æ—à–∏—Ä–µ–Ω–∞ –ø—Ä–æ–±–ª–µ–º–∞
3. **–ü–µ—Ä–µ–≤–∏—â–µ–Ω–Ω—è –¥–æ–≤–∂–∏–Ω–∏ —Ä—è–¥–∫—ñ–≤** - –±–∞–≥–∞—Ç–æ —Ä—è–¥–∫—ñ–≤ >150 —Å–∏–º–≤–æ–ª—ñ–≤
4. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ñ –≤—ñ–¥—Å—Ç—É–ø–∏** - –Ω–µ–≤—ñ–¥–ø–æ–≤—ñ–¥–Ω—ñ—Å—Ç—å —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º
5. **–í—ñ–¥—Å—É—Ç–Ω—ñ—Å—Ç—å –Ω–æ–≤–∏—Ö —Ä—è–¥–∫—ñ–≤ –≤ –∫—ñ–Ω—Ü—ñ —Ñ–∞–π–ª—ñ–≤**

### –§–∞–π–ª–∏ –∑ –Ω–∞–π–±—ñ–ª—å—à–æ—é –∫—ñ–ª—å–∫—ñ—Å—Ç—é –ø–æ–º–∏–ª–æ–∫
- `DriverUpdatesController.php` - 699 –ø–æ–º–∏–ª–æ–∫
- `DistanceController.php` - 176 –ø–æ–º–∏–ª–æ–∫
- `GeocoderService.php` - 76 –ø–æ–º–∏–ª–æ–∫

## üü° –ü—Ä–æ–±–ª–µ–º–∏ –∑ —è–∫—ñ—Å—Ç—é –∫–æ–¥—É (PHPMD)

### 1. –í–∏—Å–æ–∫–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –º–µ—Ç–æ–¥—ñ–≤
- `DistanceController::calculateDistancesForLoad()` - —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å 21 (–ø–æ—Ä—ñ–≥ 10)
- `TruckController::update()` - —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å 33 (–ø–æ—Ä—ñ–≥ 10)
- `GeocoderService::parseAndNormalizeFeatures()` - —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å 25 (–ø–æ—Ä—ñ–≥ 10)

### 2. –ù–∞–¥—Ç–æ –¥–æ–≤–≥—ñ –º–µ—Ç–æ–¥–∏
- `DistanceController::calculateDistancesForLoad()` - 186 —Ä—è–¥–∫—ñ–≤ (–ø–æ—Ä—ñ–≥ 100)
- `TruckController::update()` - 236 —Ä—è–¥–∫—ñ–≤ (–ø–æ—Ä—ñ–≥ 100)
- `DriverUpdatesController::getDriverUpdatesHeatmap()` - 162 —Ä—è–¥–∫–∏ (–ø–æ—Ä—ñ–≥ 100)

### 3. –í–∏—Å–æ–∫–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å –∫–ª–∞—Å—ñ–≤
- `TruckController` - –∑–∞–≥–∞–ª—å–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å 128 (–ø–æ—Ä—ñ–≥ 50)
- `DriverController` - –∑–∞–≥–∞–ª—å–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å 106 (–ø–æ—Ä—ñ–≥ 50)
- `GeocoderService` - –∑–∞–≥–∞–ª—å–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å 109 (–ø–æ—Ä—ñ–≥ 50)

### 4. –°—Ç–∞—Ç–∏—á–Ω—ñ –≤–∏–∫–ª–∏–∫–∏
- –ú–∞—Å–æ–≤–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–∞—Ç–∏—á–Ω–∏—Ö –º–µ—Ç–æ–¥—ñ–≤ –∑–∞–º—ñ—Å—Ç—å dependency injection
- –ü—Ä–æ–±–ª–µ–º–∏ –∑ —Ç–µ—Å—Ç—É–≤–∞–Ω–Ω—è–º —Ç–∞ –ø—ñ–¥—Ç—Ä–∏–º–∫–æ—é

### 5. –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—É–ø–µ—Ä–≥–ª–æ–±–∞–ª—å–Ω–∏—Ö –∑–º—ñ–Ω–Ω–∏—Ö
- `$_GET`, `$_POST`, `$_SERVER`, `$_ENV` - –±–µ–∑–ø–æ—Å–µ—Ä–µ–¥–Ω—ñ–π –¥–æ—Å—Ç—É–ø

## üîµ –î—É–±–ª—ñ–∫–∞—Ç–∏ –∫–æ–¥—É (PHPCPD)

### –ó–Ω–∞–π–¥–µ–Ω—ñ –¥—É–±–ª—ñ–∫–∞—Ç–∏
1. **58 —Ä—è–¥–∫—ñ–≤** - `DistanceController.php:622-680` ‚Üî `MapboxService.php:33-91`
2. **43 —Ä—è–¥–∫–∏** - `DistanceController.php:1017-1060` ‚Üî `DistanceCacheService.php:51-94`
3. **42 —Ä—è–¥–∫–∏** - `DistanceController.php:705-747` ‚Üî `DistanceCacheService.php:130-172`

## üìä –ê–Ω–∞–ª—ñ–∑ –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π (PDepend)

### –ú–µ—Ç—Ä–∏–∫–∏ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
- **–¶–∏–∫–ª–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å**: 258 –º–µ—Ç–æ–¥—ñ–≤ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
- **NPath —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å**: 258 –º–µ—Ç–æ–¥—ñ–≤ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ
- **–ó–≤'—è–∑–Ω—ñ—Å—Ç—å –º—ñ–∂ –æ–±'—î–∫—Ç–∞–º–∏**: 218 –∫–ª–∞—Å—ñ–≤ –ø—Ä–æ–∞–Ω–∞–ª—ñ–∑–æ–≤–∞–Ω–æ

## üö® –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó —â–æ–¥–æ –≤–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è

### 1. –ù–µ–≥–∞–π–Ω—ñ –¥—ñ—ó
- –í–∏–¥–∞–ª–∏—Ç–∏ –∞–±–æ —Ä–µ–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –Ω–µ–≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω—ñ –º–µ—Ç–æ–¥–∏
- –í–∏–ø—Ä–∞–≤–∏—Ç–∏ –Ω–µ–≤–∏–∑–Ω–∞—á–µ–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Ç–∞ –≤–ª–∞—Å—Ç–∏–≤–æ—Å—Ç—ñ
- –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑—É–≤–∞—Ç–∏ –≤—ñ–¥—Å—Ç—É–ø–∏ (–∑–∞–º—ñ–Ω–∏—Ç–∏ —Ç–∞–±–∏ –Ω–∞ –ø—Ä–æ–±—ñ–ª–∏)

### 2. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- –†–æ–∑–±–∏—Ç–∏ –¥–æ–≤–≥—ñ –º–µ—Ç–æ–¥–∏ –Ω–∞ –º–µ–Ω—à—ñ
- –ó–º–µ–Ω—à–∏—Ç–∏ —Ü–∏–∫–ª–æ–º–∞—Ç–∏—á–Ω—É —Å–∫–ª–∞–¥–Ω—ñ—Å—Ç—å
- –í–∏–Ω–µ—Å—Ç–∏ –¥—É–±–ª—ñ–∫–∞—Ç–∏ –≤ –æ–∫—Ä–µ–º—ñ –º–µ—Ç–æ–¥–∏/–∫–ª–∞—Å–∏
- –ó–∞–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç–∏—á–Ω—ñ –≤–∏–∫–ª–∏–∫–∏ –Ω–∞ dependency injection

### 3. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏
- –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ proper dependency injection
- –°—Ç–≤–æ—Ä–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∏ –¥–ª—è —Å–µ—Ä–≤—ñ—Å—ñ–≤
- –î–æ–¥–∞—Ç–∏ unit —Ç–µ—Å—Ç–∏
- –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ CI/CD –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∏–º –∞–Ω–∞–ª—ñ–∑–æ–º –∫–æ–¥—É

### 4. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—è
- –ù–∞–ª–∞—à—Ç—É–≤–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ñ–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∫–æ–¥—É
- –í–ø—Ä–æ–≤–∞–¥–∏—Ç–∏ pre-commit hooks
- –î–æ–¥–∞—Ç–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω—É –ø–µ—Ä–µ–≤—ñ—Ä–∫—É —è–∫–æ—Å—Ç—ñ –≤ pipeline

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –º—ñ–≥—Ä–∞—Ü—ñ–π

### –ü–æ—Ç–æ—á–Ω–∏–π —Å—Ç–∞–Ω
- **–§–∞–π–ª–∏ –º—ñ–≥—Ä–∞—Ü—ñ–π**: –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ
- **–°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å**: –¢—ñ–ª—å–∫–∏ –≤ –∫–æ–¥—ñ —Å–µ—Ä–≤—ñ—Å—ñ–≤
- **–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—è**: –°—Ç–≤–æ—Ä–∏—Ç–∏ proper migration system

### –ü–ª–∞–Ω–∏ –Ω–∞ –º–∞–π–±—É—Ç–Ω—î
- [ ] –°—Ç–≤–æ—Ä–∏—Ç–∏ —Å–∏—Å—Ç–µ–º—É –º—ñ–≥—Ä–∞—Ü—ñ–π
- [ ] –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–∞–±–ª–∏—Ü—å –≤ –º—ñ–≥—Ä–∞—Ü—ñ—ó
- [ ] –î–æ–¥–∞—Ç–∏ –≤–µ—Ä—Å—ñ–æ–Ω—É–≤–∞–Ω–Ω—è —Å—Ö–µ–º–∏ –ë–î

## üéØ –ü—Ä—ñ–æ—Ä–∏—Ç–µ—Ç–∏

### –í–∏—Å–æ–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
1. –í–∏–ø—Ä–∞–≤–ª–µ–Ω–Ω—è –∫—Ä–∏—Ç–∏—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫ PHPStan
2. –°—Ç–∞–Ω–¥–∞—Ä—Ç–∏–∑–∞—Ü—ñ—è –≤—ñ–¥—Å—Ç—É–ø—ñ–≤
3. –í–∏–¥–∞–ª–µ–Ω–Ω—è –º–µ—Ä—Ç–≤–æ–≥–æ –∫–æ–¥—É

### –°–µ—Ä–µ–¥–Ω—ñ–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
1. –†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥ –¥–æ–≤–≥–∏—Ö –º–µ—Ç–æ–¥—ñ–≤
2. –£—Å—É–Ω–µ–Ω–Ω—è –¥—É–±–ª—ñ–∫–∞—Ç—ñ–≤
3. –ü–æ–∫—Ä–∞—â–µ–Ω–Ω—è –∞—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∏

### –ù–∏–∑—å–∫–∏–π –ø—Ä—ñ–æ—Ä–∏—Ç–µ—Ç
1. –û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è –º–µ—Ç—Ä–∏–∫ —Å–∫–ª–∞–¥–Ω–æ—Å—Ç—ñ
2. –î–æ–¥–∞–≤–∞–Ω–Ω—è unit —Ç–µ—Å—Ç—ñ–≤
3. –í–ø—Ä–æ–≤–∞–¥–∂–µ–Ω–Ω—è CI/CD

---

*–ó–≤—ñ—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é —ñ–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ñ–≤: PHPStan, PHP CodeSniffer, PHPMD, PHPCPD, PDepend*
